-- SoulMatch Migration
-- version: 21.0
-- Fixes RLS policies to allow users to edit and delete their own created events.

-- 1. Add UPDATE policy for user-created events
-- This allows a user to update an event if their ID matches the event's creator_user_id.
DROP POLICY IF EXISTS "Allow users to update their own created events" ON public.events;
CREATE POLICY "Allow users to update their own created events"
  ON public.events
  FOR UPDATE
  USING ((SELECT id FROM public.users WHERE auth_id = auth.uid()) = creator_user_id);

-- 2. Add DELETE policy for user-created events
-- This allows a user to delete an event if their ID matches the event's creator_user_id.
-- This will work alongside the existing policy for organization owners.
DROP POLICY IF EXISTS "Allow users to delete their own created events" ON public.events;
CREATE POLICY "Allow users to delete their own created events"
  ON public.events
  FOR DELETE
  USING ((SELECT id FROM public.users WHERE auth_id = auth.uid()) = creator_user_id);
